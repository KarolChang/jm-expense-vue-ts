import{r as C}from"./record.faac3df9.js";import{g as S}from"./dateFormat.26b8f760.js";import{_ as y,c as R,d as k,T as _}from"./index.e0544e65.js";import{S as I}from"./Spinner.5acc2245.js";import{f as D,i as w,o as a,c as m,S as N,F as b,j as E,h as o,t as v,x as B,C as U,k as M,n as L,p as F,m as $,P as j,A as T,B as O}from"./vendor.495b01ec.js";import{p as x,_ as P}from"./CreateRecordModalButton.e30c1d0f.js";const V=D({props:{record:null},setup(i){const p=i,d=R(),l=w("refetchRecords"),c=async()=>{try{const e=p.record,{value:n}=await k.fire({title:"\u8CC7\u6599\u7DE8\u8F2F",html:`
      <div class="d-flex mb-2">
        <div class="col-auto me-3">
          <label for="swal-item" class="col-form-label">\u9805\u76EE</label>
        </div>
        <div class="col-auto">
          <input value="${e.item}" type="text" id="swal-item" class="form-control"/>
        </div>
      </div>
      <div class="d-flex mb-2">
        <div class="col-auto me-3">
          <label for="swal-merchant" class="col-form-label">\u5546\u5BB6</label>
        </div>
        <div class="col-auto">
          <input value="${e.merchant}" type="text" id="swal-merchant" class="form-control" >
        </div>
      </div>
      <div class="d-flex mb-2">
        <div class="col-auto me-3">
          <label for="swal-amount" class="col-form-label">\u91D1\u984D</label>
        </div>
        <div class="col-auto">
          <input value="${e.amount}" type="number" id="swal-amount" class="form-control" >
        </div>
      </div>
      <div class="d-flex mb-2">
        <div class="col-auto me-3">
          <label for="swal-date" class="col-form-label">\u65E5\u671F</label>
        </div>
        <div class="col-auto">
          <input value="${new Date(e.date).toISOString().substring(0,10)}" type="date" id="swal-date" class="form-control" >
        </div>
      </div>
      `,preConfirm:()=>{var h;const t=document.getElementById("swal-item").value,u=document.getElementById("swal-merchant").value,s=document.getElementById("swal-amount").value,f=new Date(document.getElementById("swal-date").value);return(!t||!u||!s||!f)&&N.showValidationMessage("\u6240\u6709\u8CC7\u6599\u90FD\u662F\u5FC5\u586B\uFF01\u82E5\u7DE8\u8F2F\u8005\u70BA\u7A7A\uFF0C\u8ACB\u767B\u5165~"),{id:e.id,input:{item:t,merchant:u,amount:s,date:f,UserId:(h=d.currentUser)==null?void 0:h.id}}}});n&&r(n)}catch(e){console.error("error",e)}},r=async function(e){try{await C.edit(e.id,e.input),l(),_.fire({icon:"success",title:"\u6210\u529F\u7DE8\u8F2F\u8CC7\u6599\uFF01"}),x(`${d.nickName}${d.icon}\u7DE8\u8F2F\u4E86\u4E00\u7B46\u7D00\u9304 \u2192
${e.input.merchant}-${e.input.item} $${e.input.amount}`)}catch(n){console.error("error",n),_.fire({icon:"error",title:"\u7DE8\u8F2F\u8CC7\u6599\u5931\u6557\uFF01"})}};return(e,n)=>(a(),m("i",{class:"fas fa-edit",onClick:c}))}});var z=y(V,[["__scopeId","data-v-0dbb6de0"]]);const q={class:"d-flex mb-3",style:{width:"100vw"}},G={class:"btn btn-info fw-bold"},H=D({props:{propData:null},emits:["closeFunction"],setup(i,{emit:p}){const d=i,l=R(),c=w("refetchRecords"),r=async()=>{var t;const{isConfirmed:n}=await k.fire({icon:"info",title:"\u78BA\u5B9A\u7D50\u7B97\u8CC7\u6599\uFF1F",text:`\u7D50\u7B97\u91D1\u984D\u70BA $${d.propData.closeRecordsAmount} [\u7D50\u7B97\u8005: ${(t=l.currentUser)==null?void 0:t.displayName}]`});n&&e(d.propData.closeRecordsAmount)},e=async n=>{var t;try{if(l.currentUser){const{data:u}=await C.close({records:d.propData.closeRecords.toString(),totalAmount:n,UserId:(t=l.currentUser)==null?void 0:t.id});p("closeFunction","closeRecord"),c(),u.data.recordsNotFound.length||u.data.recordsClosedBefore.length?_.fire({icon:"success",title:"\u6210\u529F\u7D50\u7B97\u8CC7\u6599\uFF01\u6709\u90E8\u5206\u8CC7\u6599\u672A\u80FD\u627E\u5230\u6216\u662F\u5DF2\u7D93\u7D50\u7B97\u904E\u3002"}):_.fire({icon:"success",title:"\u6210\u529F\u7D50\u7B97\u8CC7\u6599\uFF01"}),x(`${l.nickName}${l.icon}\u7D50\u7B97\u7D00\u9304 \u2192 \u7E3D\u91D1\u984D $${n}`)}}catch(u){console.error("error",u),_.fire({icon:"error",title:"\u7D50\u7B97\u8CC7\u6599\u5931\u6557\uFF01"})}};return(n,t)=>(a(),m("div",q,[i.propData.isCloseStatus?(a(),m(b,{key:1},[o("div",G,"\u7D50\u7B97\u91D1\u984D $"+v(i.propData.closeRecordsAmount),1),o("button",{type:"button",class:"btn btn-secondary ms-3",onClick:t[1]||(t[1]=u=>p("closeFunction","cancelBtnClick"))}," \u53D6\u6D88\u7D50\u7B97 "),o("button",{type:"button",class:"btn btn-success ms-3",onClick:r},"\u78BA\u5B9A\u7D50\u7B97")],64)):(a(),m(b,{key:0},[E(P,{view:"Record",class:"me-3"}),o("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=u=>p("closeFunction","closeBtnClick"))},"\u958B\u59CB\u7D50\u7B97")],64))]))}});const J=D({props:{record:null},setup(i){const p=i,d=w("refetchRecords"),l=async()=>{try{const{isConfirmed:r}=await k.fire({title:`\u78BA\u5B9A\u522A\u9664\u7D00\u9304[${p.record.item}]\u561B\uFF1F`,showCancelButton:!0});r&&c(p.record.id)}catch(r){console.error("error",r)}},c=async function(r){try{const{data:e}=await C.delete(r);if(e.status!=="success")throw new Error(`[SERVER ERROR] ${e.message}`);d(),_.fire({icon:"success",title:`\u6210\u529F\u522A\u9664\u7D00\u9304[${e.data.item}]`})}catch(e){console.error("error",e),_.fire({icon:"error",title:"\u522A\u9664\u7D00\u9304\u5931\u6557\uFF01"})}};return(r,e)=>(a(),m("i",{class:"fas fa-trash",onClick:l}))}});var K=y(J,[["__scopeId","data-v-841b8e8a"]]);const Q=i=>(T("data-v-072f01d7"),i=i(),O(),i),W={key:0},X={key:0,class:"table table-info table-hover"},Y=Q(()=>o("thead",null,[o("tr",null,[o("th",{scope:"col"},"#"),o("th",{scope:"col"}),o("th",{scope:"col"},"\u9805\u76EE"),o("th",{scope:"col"},"\u5546\u5BB6"),o("th",{scope:"col"},"\u91D1\u984D"),o("th",{scope:"col"},"\u65E5\u671F"),o("th",{scope:"col",id:"column-item"},"\u9996\u6B21\u8A18\u9304\u8005"),o("th",{scope:"col",id:"column-item"},"\u9996\u6B21\u8A18\u9304\u6642\u9593"),o("th",{scope:"col",id:"column-item"},"\u66F4\u65B0\u6642\u9593")])],-1)),Z=["onClick"],ee=["checked"],te={id:"column-item"},oe={id:"column-item"},se={id:"column-item"},ce={key:1,class:"img-fluid",src:"https://memeprod.sgp1.digitaloceanspaces.com/user-wtf/1581909112681.jpg",alt:""},ue=D({setup(i){const p=R(),d=B(!0),l=B([]),c=B({isCloseStatus:!1,closeRecords:[],closeRecordsAmount:0}),r=async function(){try{const{data:t}=await C.getAll();l.value=t.data.filter(u=>u.isClosed===!1),d.value=!1}catch(t){console.error("error",t)}},e=(t,u)=>{if(console.log("checkboxClick"),c.value.isCloseStatus){const s=c.value.closeRecords.findIndex(f=>f===t);s!==void 0&&(s!==-1?(c.value.closeRecords.splice(s,1),c.value.closeRecordsAmount-=u):(c.value.closeRecords.push(t),c.value.closeRecordsAmount+=u))}},n=t=>{if(t==="cancelBtnClick"&&(c.value.isCloseStatus=!1,c.value.closeRecords=[],c.value.closeRecordsAmount=0),t==="closeBtnClick"){c.value.isCloseStatus=!0;const u=[];let s=0;for(let f of l.value)u.push(f.id),s+=f.amount;c.value.closeRecords=u,c.value.closeRecordsAmount=s}t==="closeRecord"&&(c.value.isCloseStatus=!1)};return r(),U("refetchRecords",r),(t,u)=>d.value?(a(),F(I,{key:1})):(a(),m("div",W,[E(H,{propData:c.value,onCloseFunction:n},null,8,["propData"]),l.value.length?(a(),m("table",X,[Y,o("tbody",null,[(a(!0),m(b,null,M(l.value,(s,f)=>{var h,g,A;return a(),m("tr",{key:f,class:L({"table-success":(h=c.value.closeRecords)==null?void 0:h.includes(s.id)}),onClick:le=>e(s.id,s.amount)},[o("td",null,[c.value.isCloseStatus?(a(),m("input",{key:0,class:"form-check-input",type:"checkbox",checked:(g=c.value.closeRecords)==null?void 0:g.includes(s.id)},null,8,ee)):(a(),F(z,{key:1,record:s},null,8,["record"]))]),o("td",null,[((A=$(p).currentUser)==null?void 0:A.Role.name_en)==="root"?(a(),F(K,{key:0,record:s},null,8,["record"])):j("",!0)]),o("td",null,v(s.item),1),o("td",null,v(s.merchant),1),o("td",null,v(s.amount),1),o("td",null,v(new Date(s.date).toLocaleDateString()+" "+$(S)(s.date)),1),o("td",te,v(s.User.displayName),1),o("td",oe,v(new Date(s.createdAt).toLocaleString()),1),o("td",se,v(new Date(s.updatedAt).toLocaleString()),1)],10,Z)}),128))])])):(a(),m("img",ce))]))}});var pe=y(ue,[["__scopeId","data-v-072f01d7"]]);export{pe as default};
